# 年会抽奖Web接口说明

**前端首页是后台在通过微信授权登录后跳转过来的，此时后端已经拿到用户数据，若接口返回code为1003，说明是在未通过微信授权的情况下直接访问的接口。前端在收到code为1003的返回时需要将页面跳转到/lottery/auth下，微信将重新进行授权。**

全局统一返回数据格式如下：

```json5
{
  "code": 0,    // 状态码
  "msg": "ok",  // 消息
  "data": null  // 携带数据，下方接口说明中的接口返回部分只描述该字段
}
```

### 1\. 获取用户数据

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| GET | /lottery/user |

**接口返回**
```json5
{
  "data": {
    "openid": "",       // 用户唯一ID
    "name": "",         // 真实姓名
    "nickname": "",     // 微信昵称
    "groupName": "",    // 部门名称
    "telephone": "",    // 手机号码
    "headImgUrl": "",   // 头像URL地址
    "checkin_time": "", // 签到时间（未签到用户不返回该字段） 
    "master": 0         // 是否为管理员
  }
}
```

### 2\. 获取签到用户列表

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| GET | /lottery/user/list |

**接口返回**

最近签到的在前面，未签到的在最后
```json5
{
  "data": [
    {
        "openid": "",       // 用户唯一ID
        "name": "",         // 真实姓名
        "nickname": "",     // 微信昵称
        "groupName": "",    // 部门名称
        "telephone": "",    // 手机号码
        "headImgUrl": "",   // 头像URL地址
        "checkin_time": "", // 签到时间（未签到用户不返回该字段） 
        "master": 0         // 是否为管理员
    }
  ]
}
```

### 3\. 用户签到

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| POST | /lottery/user/checkin |

**接口返回**
```json5
{
  "data": {
    "id": "",       // ID
    "luckyNum": ""  // 抽奖号码
  }
}
```

### 4\. 获取抽奖号码

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| GET | /lottery/luckyNum |

**接口返回**
```json5
{
  "data": {
    "id": "",       // ID
    "luckyNum": ""  // 抽奖号码
  }
}
```

### 5\. 获取下一次抽奖信息

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| GET | /lottery/next |

**接口返回**
```json5
{
  "data": {
    "id": "",       // ID
    "name": ""      // 抽奖类型名称
  }
}
```

### 6\. 开始抽奖

**接口信息**

| 请求方式 | URI | 参数名 | 参数类型 | 备注 |
| :----: | :----: | :----: | :----: | :----: |
| POST | /lottery/roll |

**接口返回**
```json5
{
  "data": {
    "luckyNum": "",         // 中奖号码
    "createTime": "",       // 中奖时间
    "user": {               // 中奖用户信息
        "openid": "",       // 用户唯一ID
        "name": "",         // 真实姓名
        "nickname": "",     // 微信昵称
        "groupName": "",    // 部门名称
        "telephone": "",    // 手机号码
        "headImgUrl": "",   // 头像URL地址
        "checkin_time": "", // 签到时间（未签到用户不返回该字段） 
        "master": 0         // 是否为管理员
    },
    "reward": {
        "id": "",           // ID
        "name": ""          // 抽奖类型名称
    }
  }
}
```

## 错误码列表

| 错误码 | 说明 |
| :----: | :----: |
| 0 | 成功 |
| 404 | 请求地址无效 |
| 405 | 请求方法无效 |
| 500 | 服务器异常 |
| 1001 | 参数错误 |
| 1002 | 未登录 |
| 1003 | 已经签过到了 |
| 1004 | 权限不足 |
| 1005 | 奖池为空 |
